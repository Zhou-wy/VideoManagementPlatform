
## ffmpeg 由rtsp推流rtmp

### 1.安装推流服务器

- 获取nginx和nginx-rtmp-module源码

```shell
wget http://nginx.org/download/nginx-1.13.3.tar.gz
tar -xvzf nginx-1.13.3.tar.gz
cd nginx-1.13.3
git clone https://github.com/arut/nginx-rtmp-module.git
```

- 编译nginx和安装nginx
```shell
sudo apt-get install libssl-dev zlib1g-dev libpcre3-dev
./configure --add-module=./nginx-rtmp-module
make -j4
sudo make install
```

- nginx 配置文件
```text
http {
    server {
        listen 80;
        location /flv {
#flv_live on; #打开 HTTP 播放 FLV 直播流功能
            chunked_transfer_encoding on; #支持 'Transfer-Encoding: chunked' 方式回复

            add_header 'Access-Control-Allow-Origin' '*'; #添加额外的 HTTP 头
            add_header 'Access-Control-Allow-Credentials' 'true'; #添加额外的 HTTP 头
        }
    }
}

rtmp_auto_push on;
rtmp {
    server {
        listen 1935;
        notify_method get;
        access_log  /var/log/nginx/access.log;
        chunk_size 4096;
        application live {
            # 开启直播模式
            live on;
            # 允许从任何源push流
            allow publish all;
            # 允许从任何地方来播放流
            allow play all;
            # 20秒内没有push，就断开链接。
            drop_idle_publisher 20s;
        }
    }
}

```


- 推流
```shell
ffmpeg -i "rtsp://admin:admin123@192.168.0.213:554/cam/realmonitor?channel=1&subtype=0" -vcodec copy -acodec copy -f flv "rtmp://192.168.0.10:1935/live/"
```
